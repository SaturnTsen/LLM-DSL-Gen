{
    "question": "///02-keep\n///The keyword keep has two uses in Envision, either to avoid an identation, or to define the state of a process.\n///When the keyword keep appears at the start of a where statement, the filter applies until the end of scope.\n///When the keyword keep appears at the start of a span statement, the UNfilter applies until the end of the scope.\n///At the beginning of a process block, the variables that are part of the state of the process can be declared with the keyword keep.\n///In a for loop that enumerates the values of a column, the keyword keep is used to declare the variables part of the state of the loop.\n///Idem, with a each loop, that enumerates the lines of a table\n\n///Consider the table named \"Products\" with primary dimension \"ref\" and three additional vectors \"Product\", \"Color\", \"Price\":\n/// - ref: uuid of the product, primary dimension of the table\n/// - Product: the product type\n/// - Color: the color of the product\n/// - Price: the unit price of the product\n///Consider additionally, the table named \"Orders\" with primary dimension \"orderid\" with secondary dimension \"ref\" and additional vectors \"OrderDate\", \"Qty\":\n///- ref: uuid of the product, secondary dimension of the table\n///- OrderDate: the date at which the product was ordered\n///- Qty: the quantity ordered for\n///Filter the tables, using the keyword keep to only show Products that have been bought in multiple quantities at least once.\n///Display the tables within the filtered scope.\n\ntable Products[ref] = with\n  [| as ref , as Product, as Color    , as Price |]\n  [| \"1\"      , \"shirt\"   , \"white,grey\", 10.50    |]\n  [| \"2\"      , \"pants\"   , \"blue\"      , 15.00    |]\n  [| \"3\"      , \"hat\"     , \"red\"       , 5.25     |]\n\ntable Orders[orderid] = with\n  [| as orderid, as ProductRef, as OrderDate , as Qty|]\n  [| \"order-1\" , \"1\"     , date(2024,1,18)   , 4     |]\n  [| \"order-2\" , \"2\"     , date(2024,3,15)   , 1     |]\n  [| \"order-3\" , \"1\"     , date(2024,7,21)   , 2     |]\n  [| \"order-4\" , \"1\"     , date(2024,8,6)    , 2     |]\n  [| \"order-5\" , \"1\"     , date(2024,9,19)   , 1     |]\n  [| \"order-6\" , \"3\"     , date(2024,10,4)   , 1     |]\nexpect Orders.ref = Orders.ProductRef",
    "answer": "```envision\nkeep where any(Orders.Qty > 1) by ref //this filters both Products and Orders tables thanks to primary dimension ref + the filter is persisted through the whole script since we used keep\n\nshow table \"Products\" with\n  Products.ref\n  Products.Color\n  Products.Price\n  Products.Product\n\nshow table \"Orders\" with\n  Orders.orderid\n  Orders.ref\n  Orders.OrderDate\n  Orders.ProductRef\n  Orders.Qty\n```",
    "ref": "lokad_raw_keep_02",
    "type": "coding"
}