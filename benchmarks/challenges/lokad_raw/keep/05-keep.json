{
    "question": "///05-keep\n///The keyword keep has two uses in Envision, either to avoid an identation, or to define the state of a process.\n///When the keyword keep appears at the start of a where statement, the filter applies until the end of scope.\n///When the keyword keep appears at the start of a span statement, the UNfilter applies until the end of the scope.\n///At the beginning of a process block, the variables that are part of the state of the process can be declared with the keyword keep.\n///In a for loop that enumerates the values of a column, the keyword keep is used to declare the variables part of the state of the loop.\n///Idem, with a each loop, that enumerates the lines of a table\n\n///Consider the script below.\n///1. How many lines are displayed in the \"First\" show table?\n///2. How many lines are displayed in the \"Second\" show table?\n///3. How many lines are displayed in the \"Third\" show table?\n\ntable Products[ref] = with\n  [| as ref , as Product, as Color    , as Price |]\n  [| \"1\"      , \"shirt\"   , \"white,grey\", 10.50    |]\n  [| \"2\"      , \"pants\"   , \"blue\"      , 15.00    |]\n  [| \"3\"      , \"hat\"     , \"red\"       , 5.25     |]\n\ntable Orders[orderid] = with\n  [| as orderid, as ProductRef, as OrderDate , as Qty|]\n  [| \"order-1\" , \"1\"     , date(2024,1,18)   , 4     |]\n  [| \"order-2\" , \"2\"     , date(2024,3,15)   , 1     |]\n  [| \"order-3\" , \"1\"     , date(2024,7,21)   , 2     |]\n  [| \"order-4\" , \"1\"     , date(2024,8,6)    , 2     |]\n  [| \"order-5\" , \"1\"     , date(2024,9,19)   , 1     |]\n  [| \"order-6\" , \"3\"     , date(2024,10,4)   , 1     |]\nexpect Orders.ref = Orders.ProductRef\n\n\nshow table \"First\" with\n  Orders.orderid\n\nkeep where Products.ref == \"1\"\n\nshow table \"Second\" with\n  Orders.orderid\n\nwhere Orders.Qty > 1\n  show table \"Third\" with\n    Orders.orderid",
    "answer": "///1. No filter is applied, the number of lines in the \"First\" show is the number of lines in Orders i.e 6\n///2. A keep filter on primary dimension \"ref\" in Products is applied to keep only Product \"1\".\n///Since the Orders table is downstream Products and linked through the \"ref\" dimension, the Orders table is also filtered on \"1\" only.\n///Therefore \"Second\" only shows 4 lines.\n///3. A where filter is appliÃ© to the Orders table to select only lines with Qty > 1. But the previous filter on ref == \"1\"\n///was applied with a keep therefore this filter is still in effect and combines with Qty > 1, the \"Third\" show has 3 lines.",
    "ref": "",
    "type": "QA"
}